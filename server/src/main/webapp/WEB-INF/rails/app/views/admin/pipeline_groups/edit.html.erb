<% @view_title = "Edit Pipeline Group" -%>

<div class="admin_workspace">
    <%= form_for(@group, :as => :group, :url => pipeline_group_update_path, :html => {:method => "PUT", :id => "group_edit_form"}) do |f| %>

        <div class="form_content">
            <h3>Basic Settings</h3>

            <div class="fieldset">
                <%= md5_field %>
                <%== required_label(f, com.thoughtworks.go.config.PipelineConfigs::GROUP, 'Pipeline Group Name') -%>
                <%= f.text_field com.thoughtworks.go.config.PipelineConfigs::GROUP, {:class => "form_input", :readonly => @group.hasRemoteParts()} -%>
                <%= error_message_on(@group, com.thoughtworks.go.config.PipelineConfigs::GROUP, :css_class => "form_error") %>
                <div class="clear"></div>
            </div>

            <div class="permissions">

                    <h3> User Permissions </h3>
                    <span title="Permissions specified here will apply to all pipelines under this group" class="contextual_help has_go_tip_right"></span>

                    <div class="instructions">
                        All system administrators and pipeline group administrators belonging to roles configured below will automatically have admin rights (this cannot be overridden).
                    </div>
                    <div class="fieldset user_permissions_for_group">
                        <%= render :partial => 'permissions_table',
                                   :locals => {:scope => {:permissions => @group.getAuthorization().getUserAuthorizations(), :permission_type => com.thoughtworks.go.config.Authorization::UserType::USER, :f => f, :autocomplete_suggestions => @autocomplete_users}} %>
                         <div class="clear"></div>
                    </div>

                    <h3> Role Permissions </h3>
                    <span title="Permissions specified here will apply to all pipelines under this group" class="contextual_help has_go_tip_right"></span>
                    <div class="fieldset role_permissions_for_group">
                        <%= render :partial => 'permissions_table',
                                   :locals => {:scope => {:permissions => @group.getAuthorization().getRoleAuthorizations(), :permission_type => com.thoughtworks.go.config.Authorization::UserType::ROLE, :f => f, :autocomplete_suggestions => @autocomplete_roles}} %>
                         <div class="clear"></div>
                    </div>


            </div>
        </div>
        <%= render :partial => "admin/shared/form_submit", :locals => {:scope => {:reset_url => pipeline_group_edit_path}} %>

    <% end %>

</div>
<script type="text/javascript">
    Util.on_load(function() {
        var groupPermissions = new GroupPermissions("<%=com.thoughtworks.go.config.Authorization::PrivilegeState::ON-%>",
                "<%=com.thoughtworks.go.config.Authorization::PrivilegeState::OFF-%>",
                "<%=com.thoughtworks.go.config.Authorization::PrivilegeState::DISABLED-%>");

        groupPermissions.bindFromHiddenField();
        groupPermissions.bindHandlers();
    });
</script>

<%= render :partial => "admin/shared/dirty_form", :locals => {:scope => {:form_id => 'group_edit_form', :reset_id => "reset_form"}} %>
<%= render :partial => 'shared/convert_tool_tips.html', :locals => {:scope => {}} %>
